box: golang

build:

  steps:

    - setup-go-workspace:
        package-dir: github.com/yieldr/terraform-provider-auth0

    - script:
        name: build
        code: |
            make clean packages BUILD_PATH=$WERCKER_OUTPUT_DIR

    - script:
        name: run tests
        code: |
          make testacc OPTS=-coverprofile=c.out

    - yieldr/test-reporter:
        id: $CODECLIMATE_REPO_TOKEN
    
deploy:

  steps:

    - github-create-release:
        token: $GITHUB_TOKEN
        tag: v1.0.0

    - github-upload-asset:
        token: $GITHUB_TOKEN
        file: ./terraform-provider-auth0_darwin_amd64.tar.gz
        filename: terraform-provider-auth0_darwin_amd64.tar.gz
        content-type: application/x-gzip

    - github-upload-asset:
        token: $GITHUB_TOKEN
        file: ./terraform-provider-auth0_linux_amd64.tar.gz
        filename: terraform-provider-auth0_linux_amd64.tar.gz
        content-type: application/x-gzip

    
